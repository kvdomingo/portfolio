---
import { Resize } from "@cloudinary/url-gen/actions/resize";
import Layout from "@/layouts/Layout.astro";
import PhotographyLayout from "@/layouts/PhotographyLayout.astro";
import Gallery from "@/components/photography/Gallery.astro";
import cld, { cld2, DEFAULT_OPTIONS } from "@/server/utils/cloudinary";
import type { ResourceApiResponse } from "cloudinary";

export function getStaticPaths() {
  return [
    { params: { slug: "latest" } },
    { params: { slug: "live" } },
    { params: { slug: "portraits" } },
    { params: { slug: "samoetikerffa" } },
  ];
}

const { slug = "" } = Astro.params;

const title = slug[0].toUpperCase() + slug.slice(1);

const body = (await cld2.api.resources({
  ...DEFAULT_OPTIONS,
  prefix: `kdphotography/portfolio/static/portfolio/media-private/${title}`,
})) as ResourceApiResponse;

const { resources = [] } = body;

const images = resources.map<ResourceApiResponse["resources"][number]>(
  resource => ({
    ...resource,
    secure_url: cld
      .image(resource.public_id)
      .resize(Resize.scale().width("auto"))
      .toURL(),
  }),
);

images.sort((a, b) => b.created_at.localeCompare(a.created_at));
---

<Layout title={`${title} | Photography | KVD Studio`}>
  <PhotographyLayout>
    <Gallery images={images} />
  </PhotographyLayout>
</Layout>
